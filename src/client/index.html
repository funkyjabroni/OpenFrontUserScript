<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenFront (ALPHA)</title>
    <link rel="manifest" href="../../resources/manifest.json" />

    <!-- Critical CSS to prevent FOUC -->
    <style>
      .preload * {
        -webkit-transition: none !important;
        -moz-transition: none !important;
        -ms-transition: none !important;
        -o-transition: none !important;
        transition: none !important;
      }

      html {
        visibility: visible;
        opacity: 1;
      }

      html.preload {
        visibility: hidden;
        opacity: 0;
      }

      /* display:none if child has class parent-hidden since we can't use shadow DOM in Lit due to Tailwind */
      .component-hideable:has(> .parent-hidden) {
        display: none;
      }
    </style>

    <!-- Immediate execution to prevent FOUC -->
    <script>
      document.documentElement.className = "preload";
    </script>

    <!-- Playwire ads -->
    <script>
      window.ramp = window.ramp || {};
      window.ramp.que = window.ramp.que || [];
      window.ramp.passiveMode = true;
    </script>

    <!-- Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=AW-16702609763"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }

      gtag("js", new Date());
      gtag("config", "AW-16702609763");
    </script>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-WQGQQ8RDN4"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-WQGQQ8RDN4");
    </script>
  </head>
  <!-- ------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
  <body
    class="min-h-screen bg-backgroundDark flex flex-col items-center justify-between relative overflow-auto"
  >
    <!-- Background -->
    <app-background></app-background>
    <!-- Overlay pixelation -->
    <div class="scanlines"></div>

    <div class="relative w-full max-w-7xl mx-auto px-4 pt-8">
      <!-- Header -->
      <main-navbar></main-navbar>
      <gutter-ad-modal></gutter-ad-modal>
      <!-- Game Interface -->
      <main class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
        <!--  Main Game Area and Buttons -->
        <div class="lg:col-span-8 space-y-8">
          <!--  Game card component -->
          <public-lobby></public-lobby>

          <!-- Action Buttons -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <o-button
              id="join-private-lobby-button"
              title="Join Lobby"
              translationKey="main.join_lobby"
              icon="icons/users.svg"
              class="w-full"
            ></o-button>

            <o-button
              id="logout-discord"
              title="Log out"
              translationKey="main.log_out"
              visible="false"
              block
            ></o-button>

            <div class="container__row">
              <flag-input class="w-[20%] md:w-[15%]"></flag-input>
              <username-input class="relative w-full"></username-input>
              <news-button class="w-[20%] md:w-[15%]"></news-button>
            </div>
            <div></div>
            <div>
              <public-lobby class="block"></public-lobby>
            </div>
            <div class="container__row container__row--equal">
              <o-button
                id="host-lobby-button"
                title="Create Lobby"
                translationKey="main.create_lobby"
                block
                secondary
              ></o-button>
              <o-button
                id="join-private-lobby-button"
                title="Join Lobby"
                translationKey="main.join_lobby"
                block
                secondary
              ></o-button>
              <!-- <o-button
            id="chat-button"
            title="Chat Test"
            block
            secondary
          ></o-button> -->
            </div>

            <o-button
              id="single-player"
              title="Single Player"
              translationKey="main.single_player"
              icon="icons/user.svg"
              secondary
              class="w-full"
            ></o-button>

            <o-button
              id="help-button"
              title="Instructions"
              translationKey="main.instructions"
              icon="icons/book-open.svg"
              secondary
              class="w-full"
            ></o-button>

            <!-- Language Selection -->
            <div class="col-span-1 md:col-span-2">
              <lang-selector></lang-selector>
            </div>
          </div>
        </div>
        <!--  Side Panel Right -->
        <div class="lg:col-span-4 space-y-4">
          <!-- Quick Join -->
          <div class="background-panel p-4">
            <h3
              class="font-title text-medium text-textLight mb-4"
              translationKey="main.quick_join"
            >
              QUICK JOIN
            </h3>
            <div class="space-y-4">
              <div class="flex gap-2">
                <div class="flex-1 relative">
                  <div class="relative">
                    <username-input></username-input>
                  </div>
                </div>
                <div class="flex gap-1 relative">
                  <!-- Flag Selection -->
                  <flag-trigger-button></flag-trigger-button>
                  <!-- Pattern Selection (placeholder) -->
                  <button
                    class="h-full background-panel px-4 p-0 py-3 flex items-center justify-center min-w-[48px] hover:bg-backgroundDarkLighter"
                  >
                    <o-icon
                      src="icons/squares-exclude.svg"
                      size="medium"
                      color="var(--text-color-white)"
                    ></o-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Latest News -->
          <div class="background-panel p-4 relative">
            <div class="flex items-center justify-between mb-4">
              <h3
                class="font-title text-medium text-textLight"
                translationKey="main.latest_news"
              >
                LATEST NEWS
              </h3>
              <o-icon
                src="icons/bell.svg"
                size="medium"
                color="var(--text-color-grey)"
              ></o-icon>
            </div>
            <div class="space-y-4">
              <news-button file="/data/weekend-tournament.json"> </news-button>
              <news-button file="/data/v23.0.json"> </news-button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- User Setting -->
    <div class="fixed bottom-6 right-6 z-50">
      <button
        id="settings-button"
        title="Settings"
        class="pixel-button flex items-center justify-center p-3"
      >
        <o-icon
          src="icons/settings.svg"
          size="large"
          color="var(--text-color-light)"
        ></o-icon>
      </button>
    </div>

    <!-- In-Game components -->
    <div id="customMenu" class="mt-4 sm:mt-6 lg:mt-8">
      <ul></ul>
    </div>
    <div id="app"></div>
    <div id="radialMenu" class="radial-menu"></div>
    <div class="flex gap-2 fixed right-[10px] top-[10px] z-50 flex-col">
      <options-menu></options-menu>
      <player-info-overlay></player-info-overlay>
    </div>
    <div
      class="fixed bottom-[30px] sm:bottom-auto sm:top-[20px] z-50 mx-auto max-w-max inset-x-0 items-center"
    >
      <heads-up-message></heads-up-message>
    </div>

    <div
      class="bottom-0 w-full flex-col-reverse sm:flex-row z-50 md:w-[320px]"
      style="position: fixed; pointer-events: none"
    >
      <div
        class="w-full md:w-2/3 md:fixed sm:right-0 md:bottom-0 md:flex flex-col items-end"
        style="pointer-events: none"
      >
        <chat-display></chat-display>
        <events-display></events-display>
      </div>
      <div style="pointer-events: auto">
        <control-panel></control-panel>
      </div>
    </div>

    <!-- Game modals and overlays -->
    <game-ui-components></game-ui-components>

    <!-- Ads -->
    <left-in-game-ad></left-in-game-ad>

    <!-- Footer section -->
    <main-footer></main-footer>
    <!-- Scripts -->
    <script>
      // Remove preload class after everything is loaded
      window.addEventListener("load", function () {
        requestAnimationFrame(() => {
          document.documentElement.classList.remove("preload");
        });
      });
    </script>

    <!-- Playwire ads -->
    <script async src="//cdn.intergient.com/1025558/75940/ramp.js"></script>

    <!-- Analytics -->
    <script
      defer
      src="https://static.cloudflareinsights.com/beacon.min.js"
      data-cf-beacon='{"token": "03d93e6fefb349c28ee69b408fa25a13"}'
    ></script>
  </body>
</html>
